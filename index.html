<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>saveforascream</title>
  <style>
    :root{ --bg:#000; --fg:#ddd; --muted:#a8a8a8; }
    html,body{
      height:100%; margin:0; background:var(--bg); color:var(--fg);
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace; overflow:hidden;
    }
    a{ color:var(--fg); text-decoration:none }

    /* Titre central */
    #titre{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      font-size:clamp(28px,6vw,64px);
      letter-spacing:.02em; white-space:nowrap;
      cursor:pointer; user-select:none;
    }

    /* Zone des entrées (rangée horizontale) */
    #cloud{ position:relative; width:100vw; height:100vh; pointer-events:none; }
    #row{
      position:absolute; left:0; top:0;           /* on pilotera left/top en JS */
      display:flex; align-items:center; gap:var(--gap,28px);
      white-space:nowrap; pointer-events:auto;     /* clics actifs sur .entry */
      visibility:hidden; opacity:0; transition:opacity .2s ease;
    }
    #row.shown{ visibility:visible; opacity:1; }

    /* Entrées */
    .entry{
      font-family:inherit;
      font-size:clamp(12px,1.6vw,16px);  /* plus petit que le titre central */
      color:var(--fg);
      white-space:nowrap;                 /* une seule ligne */
      opacity:.95;
      transition:color .25s ease, opacity .2s ease;
      padding:.1rem .2rem;
    }
    .entry:hover{ opacity:1; }
    .entry:active{ animation:flash .25s ease; }
    @keyframes flash{
      0%{color:var(--fg);}
      50%{color:#fff;}
      100%{color:var(--fg);}
    }

    .admin{ position:fixed; right:14px; bottom:10px; font-size:12px; color:var(--muted) }
  </style>
</head>
<body>
  <div id="titre">saveforascream</div>

  <div id="cloud" aria-live="polite">
    <div id="row"></div>
  </div>

  <a class="admin" href="admin.html">admin</a>

  <script>
    const JSON_PATH = 'content/index.json';
    const titre = document.getElementById('titre');
    const row   = document.getElementById('row');

    // Charger les entrées et construire la ligne
    fetch(JSON_PATH + '?_=' + Date.now())
      .then(r => r.json())
      .then(list => {
        row.innerHTML = '';
        list.forEach(it => {
          const a = document.createElement('a');
          a.className = 'entry';
          a.textContent = it.title;
          a.href = it.path;
          a.target = '_self';
          row.appendChild(a);
        });
        // première position
        repositionRow(true);
      })
      .catch(() => {
        row.innerHTML = `<span class="entry">Impossible de charger <code>${JSON_PATH}</code></span>`;
      });

    // Repositionner la rangée horizontalement + verticalement
    function repositionRow(initial=false){
      // garantir que le layout est à jour
      const W = window.innerWidth;
      const H = window.innerHeight;

      // largeur actuelle de la rangée (tout sur une ligne)
      const rect = row.getBoundingClientRect();
      const rowW = rect.width || 0;
      const margin = 16;

      // bornes horizontales (éviter de sortir de l'écran)
      const minX = margin;
      const maxX = Math.max(minX, W - rowW - margin);
      const x = rand(minX, maxX);

      // hauteur aléatoire entre 60% et 85% de l'écran
      const y = rand(H * 0.60, H * 0.85);

      row.style.left = `${x}px`;
      row.style.top  = `${y}px`;

      // espacement variable entre éléments
      const gap = Math.round(rand(16, 44));
      row.style.setProperty('--gap', `${gap}px`);

      // montrer la rangée si nécessaire
      if (initial) row.classList.add('shown');
    }

    function rand(min,max){ return Math.random() * (max - min) + min; }

    // Clic sur le titre : afficher (si caché) + repositionner à chaque clic
    titre.addEventListener('click', () => {
      row.classList.add('shown');   // assure l'affichage
      // (re)mesurer après un frame si la largeur change à la première ouverture
      requestAnimationFrame(() => repositionRow(false));
    });

    // Repositionner aussi si la fenêtre change de taille
    window.addEventListener('resize', () => {
      if (row.classList.contains('shown')) repositionRow(false);
    });
  </script>
</body>
</html>
