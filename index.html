<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>saveforascream</title>
  <style>
    :root{ --bg:#000; --fg:#ddd; --muted:#a8a8a8; }
    html,body{
      height:100%; margin:0; background:var(--bg); color:var(--fg);
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace; overflow:hidden
    }
    a{ color:var(--fg); text-decoration:none }

    /* Titre central */
    #titre{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      font-size:clamp(28px,6vw,64px);
      letter-spacing:.02em; white-space:nowrap;
      cursor:pointer; user-select:none;
    }

    #cloud{ position:relative; width:100vw; height:100vh; pointer-events:none; }

    /* Entrées */
    .entry{
      position:absolute;
      font-family:inherit;
      font-size:clamp(14px,2.2vw,20px); /* plus petit */
      color:var(--fg);
      white-space:nowrap; /* jamais de retour à la ligne */
      opacity:.95;
      transition:color .25s ease, opacity .25s ease, transform .5s ease;
      pointer-events:auto;
      padding:.15rem .25rem;
    }

    /* Flash clair au clic */
    .entry:active{ animation: flash .25s ease; }
    @keyframes flash{
      0%   { color:var(--fg); }
      50%  { color:#fff; }
      100% { color:var(--fg); }
    }

    .fade{ opacity:0 }
    .admin{ position:fixed; right:14px; bottom:10px; font-size:12px; color:var(--muted) }
  </style>
</head>
<body>
  <div id="titre">saveforascream</div>
  <div id="cloud"></div>
  <a class="admin" href="admin.html">admin</a>

  <script>
    // --------- CONFIG ---------
    const JSON_PATH = 'content/index.json';
    const MARGIN = 32;
    const AVOID_RADIUS = 140;

    // --------- ÉTAT ---------
    let ENTRIES = [];
    let shown = false;

    const titre = document.getElementById('titre');
    const cloud = document.getElementById('cloud');

    fetch(JSON_PATH + '?_=' + Date.now())
      .then(r => r.json())
      .then(list => {
        ENTRIES = list.slice();
        buildCloud();
      })
      .catch(() => {
        cloud.innerHTML = `<div class="entry" style="left:50%;top:50%;transform:translate(-50%,-50%)">
          Impossible de charger <code>${JSON_PATH}</code></div>`;
      });

    function buildCloud(){
      cloud.innerHTML = '';
      ENTRIES.forEach((it, idx) => {
        const a = document.createElement('a');
        a.className = 'entry fade';
        a.textContent = it.title;
        a.href = it.path; // clic ouvre la page
        a.target = '_self';
        cloud.appendChild(a);
      });
      positionEntries(true);
    }

    function positionEntries(initial=false){
      const W = window.innerWidth, H = window.innerHeight;
      const cx = W/2, cy = H/2;
      const entries = [...document.querySelectorAll('.entry')];

      entries.forEach(el => {
        let x, y, tries = 0;
        do{
          x = rand(MARGIN, W - MARGIN);
          y = rand(MARGIN, H - MARGIN);
          tries++;
        } while (dist(x, y, cx, cy) < AVOID_RADIUS && tries < 50);

        const tw = Math.min(300, W - 2*MARGIN);
        el.style.maxWidth = tw + 'px';
        el.style.left = x + 'px';
        el.style.top  = y + 'px';

        if (!initial) el.classList.remove('fade');
      });

      if (initial){
        entries.forEach(el => el.classList.add('fade'));
      }
    }

    function toggleShow(){
      shown = !shown;
      const entries = document.querySelectorAll('.entry');
      if (shown){
        entries.forEach(el => el.classList.remove('fade'));
        shufflePositions(); // réarrange directement
      }else{
        entries.forEach(el => el.classList.add('fade'));
      }
    }

    function shufflePositions(){ positionEntries(false); }
    function rand(min, max){ return Math.random() * (max - min) + min; }
    function dist(x1,y1,x2,y2){ return Math.hypot(x2-x1, y2-y1); }

    // Clic sur saveforascream → toggle + reposition
    titre.addEventListener('click', () => {
      if (!shown){ toggleShow(); }
      else{ shufflePositions(); }
    });

    window.addEventListener('resize', () => {
      if (shown) shufflePositions(); else positionEntries(true);
    });
  </script>
</body>
</html>
